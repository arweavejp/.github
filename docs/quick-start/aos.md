# AOS を使ってみる

[AOS](https://cookbook_ao.g8way.io/guides/aos/index.html) は分散型コンピュータ [AO](https://ao.arweave.dev/) で動いているオペレーションシステムでコマンドラインターミナル、もしくは[ウェブブラウザ](https://aosweb.arweave.net/)から気軽に利用することができます。

ここではコマンドラインターミナルで進めます。まずは AOS をインストールします。

```bash
sudo npm i -g https://get_ao.g8way.io
```

## プロセス立ち上げ

インストールが完了したら `aos` とタイプするだけでプロセスが立ち上がります。

```bash
aos
```

初めて立ち上げる場合、ホームディレクトリに自動的に Arweave JSON keyfile `.aos.json` が作成され、そのアカウントを使って自動的に AO プロセスがデプロイされます。これはデプロイしたオーナーアカウント（あなた）が所有する AOS のプロセスです。

```bash
          _____                   _______                   _____
         /\    \                 /::\    \                 /\    \
        /::\    \               /::::\    \               /::\    \
       /::::\    \             /::::::\    \             /::::\    \
      /::::::\    \           /::::::::\    \           /::::::\    \
     /:::/\:::\    \         /:::/~~\:::\    \         /:::/\:::\    \
    /:::/__\:::\    \       /:::/    \:::\    \       /:::/__\:::\    \
   /::::\   \:::\    \     /:::/    / \:::\    \      \:::\   \:::\    \
  /::::::\   \:::\    \   /:::/____/   \:::\____\   ___\:::\   \:::\    \
 /:::/\:::\   \:::\    \ |:::|    |     |:::|    | /\   \:::\   \:::\    \
/:::/  \:::\   \:::\____\|:::|____|     |:::|    |/::\   \:::\   \:::\____\
\::/    \:::\  /:::/    / \:::\    \   /:::/    / \:::\   \:::\   \::/    /
 \/____/ \:::\/:::/    /   \:::\    \ /:::/    /   \:::\   \:::\   \/____/
          \::::::/    /     \:::\    /:::/    /     \:::\   \:::\    \
           \::::/    /       \:::\__/:::/    /       \:::\   \:::\____\
           /:::/    /         \::::::::/    /         \:::\  /:::/    /
          /:::/    /           \::::::/    /           \:::\/:::/    /
         /:::/    /             \::::/    /             \::::::/    /
        /:::/    /               \::/____/               \::::/    /
        \::/    /                 ~~                      \::/    /
         \/____/                                           \/____/


ao Operating System

aos - 1.4.1
2024 - Type ".exit" to exit
aos process:  1xM1_lDZ428sJHpTX7rtcR6SrDubyRVO06JEEWs_eWo

aos>
```

プロセスの ID が表示されるので別の用途で必要であれば保存しましょう。

`ao.id` と打てば簡易的にアクセスできます。

`Ctrl-C` で　aos を終了できます。

別プロセスに名前を付けていくつでも立ち上げることができます。

```bash
aos my_process
```

また、ウォレットを指定してプロセスを立ち上げることもできます。

```bash
aos my_process2 --wallet keyfile.json 
```

ウォレットとプロセス名の組み合わせで特定のプロセスにアクセス可能です。

## メッセージを送る

AO は基本的に Arweave ストレージのプロトコルに準拠した非同期のメッセージをWasmベースのVMで処理されるプロセスがお互いに送り合うシステムです。ユーザーアカウントや別のプロセスからメッセージを受け取ったときに、どういった処理をしてどう返信をするのか等が各プロセスごとに定義できます。各プロセスはスケジューラ（シーケンサ）やVM（仮想マシン）、またメッセージのルーターを選ぶことができ、定期的にメッセージを送る Cron 等も使えるため Autonomous なスマートコントラクトが書けるようになっています。AOS は AO 上に構築可能な VM の一例に過ぎません。 EVM (Ethereum VM) や SVM (Solana VM) を AO 上で動かしインターオペラビリティを実現することも可能です。

既にデプロイされている別のプロセスにメッセージを送ります。マトリックスのモーフィアスが Autonomous エージェントとして潜んでいるのでメッセージを送ってみます。

まず、便宜上モーフィアスのプロセス ID を変数に格納しておきます。

```bash
> Morpheus = "ajrGnUq9x9-K1TY1MSiKwNWhNTbq7-IdtFa33T59b7s"
```

`Send` コマンドを使って、 `Target` と `Data` を指定してメッセージを送れます。 `Target` は送り先のプロセス ID で必須すが、残りのパラメータは相手方のプロセスが定義しているものです。

```bash
Send({ Target = Morpheus, Data = "Morpheus?" })

message added to outbox

New Message From ajr...b7s: Data = I am here. You are fS
```

しばらくすると、モーフィアスから返信が来ました。モーフィアスのプロセスは特定のメッセージを受けとると特定の返信をするようにプログラムされているからです。AO が他のブロックチェーンと違って Autonomous な理由はメッセージを受け取ったプロセスが自動的に新しいメッセージ（トランザクション）を発行していることです。AI エージェントがスマートコントラクトの上で自律的に活動することができます。これは常にユーザーがトランザクションを作成する必要のある他のブロックチェーンでは成立しません。

## 受信メッセージを閲覧する

aos の各プロセスは `Inbox` を備えており、受け取ったメッセージはここから確認することができます。　AOS 自体は Lua 言語を採用していて `#Inbox` と打つことで Inbox の `length` を取得でき、 `Inbox[#Inbox]` で最後尾のアイテムにアクセスできます。 Lua 言語のインデックスは`0`からではなく`1`から始まります。

```bash
aos> Inbox[#Inbox].Data
I am here. You are finally awake. Are you ready to see how far the rabbit hole goes?
```
でモーフィアスから受け取ったメッセージを表示することができます。

## AO エクスプローラ

全てのメッセージのやりとりは Arweave ストレージに永久記録されており、[ao.link](https://ao.link)　エクスプローラでメッセージ履歴を確認することができます。自分のプロセス ID を確認してみましょう。

- [https://www.ao.link/#/entity/7v42njWzH4_IfjKR-iCndD1u3JvmXmUHQSGAgBpq7X8](https://www.ao.link/#/entity/7v42njWzH4_IfjKR-iCndD1u3JvmXmUHQSGAgBpq7X8)

以上が AOS の基本動作になりますが、この続きは[こちらのチュートリアル](https://cookbook_ao.g8way.io/tutorials/begin/messaging.html)で確認できます。Lua で書いた関数をデプロイしたりトークンを発行したり、AIゲームに参加したり色々できます。